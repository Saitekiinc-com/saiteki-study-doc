# Lv.1 基礎: トラブルシューティングと原理原則

Lv.1のゴールは、**「Webアプリケーションで発生する問題を認識し、解決のためのアプローチを議論できること」**です。
ここでは、実際の開発現場でよくあるトラブルを題材に、プロのエンジニアがどのように思考し、解決に至るのかを追体験（ケーススタディ）します。

---

## Workshop 1: 「画面が真っ白です」 (Webの仕組み)

### 1. 🚨 問題の発覚 (Scenario)
ユーザーから**「URLを開いたけど、画面に何も表示されない（真っ白）」**という問い合わせが来ました。
あなたの手元のブラウザでも同じ現象が再現しました。

### 2. 🔍 分析 (Analysis)
「真っ白」といっても、原因は様々です。まずは**「どこで止まっているか」**を切り分けます。

*   **可能性A**: サーバーまでリクエストが届いていない？ (Network)
*   **可能性B**: サーバーは応答したが、エラーを返している？ (Server)
*   **可能性C**: データは届いたが、ブラウザが描画に失敗している？ (Client)

### 3. 🧪 仮説と検証 (Hypothesis & Verification)

#### Step 1: デベロッパーツールを開く
まずはブラウザの検証ツール（F12）を開き、**[Network]** タブを確認します。

*   **確認**: リロードした際、`index.html` や `api/data` のステータスコードは？
    *   🔴 **404 Not Found**: URLが間違っているか、ファイルが存在しない。
    *   🔴 **500 Internal Server Error**: サーバー側でプログラムがクラッシュしている。
    *   🔴 **503 Service Unavailable**: サーバーがダウンしている。
    *   🟢 **200 OK**: サーバーは正常に応答している。→ **可能性C** が濃厚。

#### Step 2: コンソールを確認する
Networkが「200 OK」なら、ブラウザ側で何かが起きているはずです。**[Console]** タブを確認します。

*   **確認**: 赤いエラーメッセージが出ていないか？
    *   `Uncaught ReferenceError: x is not defined`
    *   `TypeError: Cannot read properties of undefined`
*   **検証**: エラーメッセージをクリックし、該当のコード行へジャンプします。

### 4. ✅ 解決 (Solution)
Consoleに `TypeError` が出ていました。APIからデータが返ってくる前に、画面を描画しようとして落ちていたようです。
**「データが `null` の場合はローディングを表示する」** という修正を行い、解決しました。

---

## Workshop 2: 「計算結果がおかしいです」 (JS/TSと言語仕様)

### 1. 🚨 問題の発覚 (Scenario)
ECサイトのカート画面で、100円の商品と200円の商品を入れたところ、合計金額が **「100200円」** と表示されてしまいました。

### 2. 🔍 分析 (Analysis)
足し算（`+`）をしているはずなのに、数字が連結されています。
これはJavaScriptにおいて、**「数値」ではなく「文字列」として扱われている**可能性が高いです。

### 3. 🧪 仮説と検証 (Hypothesis & Verification)

#### Step 1: 型の確認
コードを確認すると、APIから受け取ったデータが以下のようになっていました。

```json
{
  "price": "100"
}
```

JSONでは数値も文字列として送られてくることがあります。
JavaScriptでは `"100" + "200"` は `"100200"` になります。

#### Step 2: TypeScriptの型定義を確認
TypeScriptを使っているのに、なぜエラーにならなかったのでしょうか？

*   **確認**: 型定義が `any` になっていないか？
    *   `const price: any = response.price;`
*   **検証**: `any` をやめ、`number` 型を定義してみます。するとコンパイルエラーが出るはずです。

### 4. ✅ 解決 (Solution)
APIからのレスポンスを明示的に数値に変換する処理 (`Number()`) を追加し、TypeScriptの型定義も `string` ではなく `number` として扱うように修正しました。

---

## Workshop 3: 「ログインできません」 (セキュリティとDB)

### 1. 🚨 問題の発覚 (Scenario)
「パスワードは絶対に合っているはずなのに、ログインできない」という問い合わせが多発しています。
データベースの中身を直接確認することにしました。

### 2. 🔍 分析 (Analysis)
データベースの `users` テーブルを確認すると、パスワードカラムには `password123` という文字列がそのまま（平文で）保存されていました。
しかし、ログイン処理のコードを見ると、入力されたパスワードを **ハッシュ化（暗号化）** して比較しています。

### 3. 🧪 仮説と検証 (Hypothesis & Verification)

#### Step 1: 登録処理の確認
ユーザー登録のAPIを確認します。

*   **仮説**: 登録時にハッシュ化を忘れているのではないか？
*   **検証**: 登録APIのコードを見ると、`INSERT INTO users ...` で生のパスワードをそのまま保存していました。

#### Step 2: セキュリティリスクの検討
これでは、もしデータベースの中身が流出した場合、全ユーザーのパスワードが丸見えになってしまいます。

*   **認証 (Authentication)**: 「誰か」を確認するプロセス。
*   **ハッシュ化**: 元に戻せない形式に変換すること。

### 4. ✅ 解決 (Solution)
1.  登録時に必ずハッシュ関数（bcryptなど）を通すように修正。
2.  既存の平文パスワードはもう使えないため、ユーザーにパスワードリセットを依頼する（または移行スクリプトを書く）。

---

## まとめ

プロのエンジニアは、問題が起きた時に**「勘」**で直すのではなく、
1.  **現状把握 (Network/Console/DB)**
2.  **仮説 (Hypothesis)**
3.  **検証 (Verification)**

というプロセスを経て解決に至ります。この思考プロセスこそが、Lv.1で最も身につけるべきスキルです。
